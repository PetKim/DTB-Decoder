# DTB Decoder Documentation

## Introduction
This decoding script is an extension to the capabilities of [psi46/pXar](https://github.com/psi46)'s version of its decoder. The reason for the creation of this decoder is to address an overlooked (yet a fairly detrimental) issue seen when trying to read data from a problematic TBM module; as soon as an error is detected, the program returns an error description and halts without giving the rest of the results. Additionally we are not able to analyze the raw data stream to precisely determine what happened. This decoder addresses both of these issues by giving the full decoded results of the data stream and giving the option to view the data stream if desired.

## Setup
### Required Equipment
An oscilloscope that can at least output 400 MHz signals (in this case an LC584AXL model was used) and having pXar already installed are the main requirements. Using an oscilloscope allows us to extract the data stream from the digital testboard (DTB). pXar is still needed since it contains the necessary commands that issues out the data stream. We used a GPIB to connect the oscilloscope to our computer. It's suggested you use [NI MAX](https://knowledge.ni.com/KnowledgeArticleDetails?id=kA03q000000YGQwCAO&l=en-US).

### Physical Setup
There are a few additions to the DTB setup one might already have. In the first picture, we have 1 cable connecting the D1 channel to channel 1 of the oscilloscope. This cable shows us when the trigger was sent which allows us to more accurately capture the full data stream. On the back of the DTB, we have two cables leading out connecting to channels 2 and 3, which sends out the signals used for the data stream. The 3 cables are connected to our oscilloscope which you can see in the picture below. The oscilloscope is attached to a GPIB which in turn is connected to the computer via ethernet cable. ![Front of DTB setup](https://github.com/PetKim/DTB-Decoder/assets/113554500/e561c2eb-bab3-475f-9610-e0e2520ca306) ![Back of DTB setup](https://github.com/PetKim/DTB-Decoder/assets/113554500/e2c301d8-d6f2-435c-8b1c-b46336c0fae8) ![Front of oscilloscope](https://github.com/PetKim/DTB-Decoder/assets/113554500/709d0d74-6cd9-4f11-a633-8fef1b984972) ![GPIB and oscilloscope connection](https://github.com/PetKim/DTB-Decoder/assets/113554500/d2fd5b67-b7f4-4bf2-b2de-67f5aed5b06a) ![GPIB](https://github.com/PetKim/DTB-Decoder/assets/113554500/fa2db8c0-50cb-4c59-9629-8e3b17b30ad8) When you have pXar launched, make sure to have the correct outputs. The following picture contains the necessary outputs to get the data stream. Both sdata's are set to those output channels by default but you will have to change the last one to get the trigger signal. ![pXar output signals](https://github.com/PetKim/DTB-Decoder/assets/113554500/dafdcbf8-97d4-4cc5-801b-5f9b541473d0)
You will finally then pull up the command line for pXar and type in the command ```adc```, which if everything has been setup properly, would yield results similar to the picture below. Normally you would see the trigger signal on the first channel but we had shifted the entire signal to where we could capture the full data stream. The bottom signal is negligible; it's just channel 2 subtracted from channel 3. ![Oscilloscope results](https://github.com/PetKim/DTB-Decoder/assets/113554500/426e6176-e390-4bf9-8104-6bddcf0ec799)

### Decoder Setup
As of this writing, the decoder can't automatically determine the correct channels to use when exctracting the data stream; it is set to channels 2 and 3 as default. You will have to manually edit the decoder to use the correct channels if your setup is different though it's suggested you keep the setup the same. I'm thinking of working on addressing this issue so keep an eye out. The file path to the GPIB is also set to ```C:\\Windows\\System32\\visa32.dll``` as default, which should be the case regardless. The decoder also has a crude command input setup where you'll have to rerun the program again to input a different command. I am also working on addressing this problem.
